<div id="profile" class="page">
  <h1 class="page-title">Настройки профиля</h1>

  <div class="notification success" id="profile-success" style="display: none">
    <div><i class="fas fa-check-circle"></i> Данные успешно сохранены!</div>
    <button class="close-notification" onclick="this.parentElement.style.display='none'">&times;</button>
  </div>

  <form id="profile-form">
    <div class="form-group">
      <label for="full-name">ФИО:</label>
      <input type="text" id="full-name" name="full_name" required>
    </div>

    <div class="form-group">
      <label for="birth-date">Дата рождения:</label>
      <input type="date" id="birth-date" name="birth_date" required>
    </div>

    <div class="form-group">
      <label for="phone">Телефон:</label>
      <input type="tel" id="phone" name="phone">
    </div>

    <div class="form-group">
      <label for="email">Электронная почта:</label>
      <input type="email" id="email" name="email" required>
    </div>

    <div class="form-group">
      <label for="address">Адрес:</label>
      <input type="text" id="address" name="address">
    </div>

    <div class="form-group">
      <label for="password">Новый пароль (оставьте пустым, если не хотите менять):</label>
      <input type="password" id="password" name="password">
    </div>

    <button type="button" onclick="saveProfile()">Сохранить изменения</button>
  </form>
</div>

<script>
// Загрузка данных профиля
document.addEventListener('DOMContentLoaded', function() {
    fetch('../php/lk.php')
        .then(response => response.json())
        .then(data => {
            if (data.user) {
                document.getElementById('full-name').value = data.user.full_name;
                document.getElementById('birth-date').value = data.user.birth_date;
                document.getElementById('phone').value = data.user.phone || '';
                document.getElementById('email').value = data.user.email;
                document.getElementById('address').value = data.user.address || '';
            }
        });
});

// Сохранение профиля с AJAX
function saveProfile() {
    const formData = new FormData(document.getElementById('profile-form'));
    
    fetch('../php/update_profile.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Показываем уведомление об успехе
            document.getElementById('profile-success').style.display = 'flex';
            
            // Обновляем шапку
            const fullName = document.getElementById('full-name').value;
            const names = fullName.split(' ');
            const shortName = names[0] + ' ' + (names[1] ? names[1].charAt(0) + '.' : '') + (names[2] ? names[2].charAt(0) + '.' : '');
            document.querySelector('.user-name').textContent = shortName;
            
            const initials = (names[0].charAt(0) + (names[1] ? names[1].charAt(0) : '')).toUpperCase();
            document.querySelector('.user-avatar').textContent = initials;
            
            window.scrollTo(0, 0);
        } else {
            alert('Ошибка: ' + data.message);
        }
    })
    .catch(error => {
        alert('Ошибка сети: ' + error.message);
    });
}
</script>